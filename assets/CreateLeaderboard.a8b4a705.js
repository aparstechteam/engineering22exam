var C=Object.defineProperty,D=Object.defineProperties;var L=Object.getOwnPropertyDescriptors;var w=Object.getOwnPropertySymbols;var N=Object.prototype.hasOwnProperty,T=Object.prototype.propertyIsEnumerable;var y=(n,l,o)=>l in n?C(n,l,{enumerable:!0,configurable:!0,writable:!0,value:o}):n[l]=o,k=(n,l)=>{for(var o in l||(l={}))N.call(l,o)&&y(n,o,l[o]);if(w)for(var o of w(l))T.call(l,o)&&y(n,o,l[o]);return n},g=(n,l)=>D(n,L(l));import{r as p,j as c,k as u,l as t,F as x,x as v,G as H,I as E,D as R,E as A,z as I,br as U,m as _}from"./index.cfc52130.js";import{_ as V}from"./lodash.003ecd42.js";const z={class:"container mx-auto"},G={class:"print:hidden"},J=t("div",null,[t("h1",{class:"text-lg text-center"}," Select Exams and create leaderboard ")],-1),M={class:"max-w-2xl mx-auto mt-5 overflow-x-auto"},O={class:"table w-full"},q=t("thead",null,[t("tr",null,[t("th",null,"Select"),t("th",null,"Title"),t("th",null,"Total Students")])],-1),F=["onUpdate:modelValue"],P={class:"flex justify-center gap-3 my-4 text-center"},Q=E(),K=t("span",{class:"material-icons"},"upload_file",-1),W=E(" Export "),X=[K,W],Y={class:"mx-auto mt-5 overflow-x-auto"},Z={class:"table w-full"},$=t("th",{class:"text-center"},"ID",-1),tt=t("th",{class:"text-center"},"Name",-1),et={class:"text-center"},st=t("th",{class:"text-center"},"Total Score",-1),lt={class:"text-center"},at={class:"text-center"},ot={class:"text-center"},it={setup(n){const l=p([]),o=p([]),f=p([]);(()=>{R.get(A+"?type=examlist").then(m=>{l.value=m.data.routines.map((r,e)=>{let a=[],i="https://script.google.com/macros/s/AKfycbxHZMx1M1oGvp-wPb7mHwQrfkDBpkS3BG0WtciUJ_HHJTswLgJ2Ba4f8XBLNHOkjYEERQ/exec?sheet="+r.exam.substr(39,44);return fetch(i).then(h=>h.json()).then(h=>{a=V.sortBy(h.map(s=>g(k({},s),{attempt:s.attempt||1})),[s=>-s.score,"duration"]).map((s,d)=>g(k({position:1},s),{eid:e,ttrx:s.ttrx?s.ttrx:s.name.split(" ")[0]})),f.value=[...f.value,...a.map(s=>s.ttrx)],l.value[e].results=a,l.value[e].total=a.length}),{select:!0,title:r.topic,results:a}})})})();const b=p(!1),B=()=>{b.value=!0,[...new Set(f.value)].forEach(r=>{let e="",a=l.value.filter(s=>s.select).map(s=>{let d=s.results.find(j=>j.ttrx==r);return d?(e=d.name?d.name:d.ttrx,d):{eid:s.results[0].eid,score:0,attempt:1}}),i=a.map(s=>Number(s.score)).reduce((s,d)=>s+d,0),h=a.map(s=>({eid:s.eid,score:s.score,attempt:s.attempt}));e&&(o.value=[...o.value,{ttrx:r,name:e,score:i,exams:h}])}),b.value=!1},S=()=>{let m="ID,Name,"+l.value.filter(e=>e.select).map(e=>e.title).join(",")+`,Total Score
`;o.value.forEach(e=>{m+=e.ttrx+","+e.name+","+e.exams.map(a=>a.score).join(",")+","+e.score+`
`});var r=document.createElement("a");r.href="data:text/csv;charset=utf-8,"+encodeURI(m),r.target="_blank",r.download="overall_result.csv",r.click()};return(m,r)=>(c(),u("div",z,[t("div",G,[J,t("div",M,[t("table",O,[q,t("tbody",null,[(c(!0),u(x,null,v(l.value,(e,a)=>(c(),u("tr",{key:a},[t("th",null,[I(t("input",{type:"checkbox",class:"checkbox","onUpdate:modelValue":i=>l.value[a].select=i},null,8,F),[[U,l.value[a].select]])]),t("td",null,_(e.title),1),t("td",null,_(e.total?e.total:"Loading..."),1)]))),128))])])]),t("div",P,[t("button",{onClick:B,class:H(["capitalize btn",{loading:b.value}])},"Prepare Overall Leaderboard",2),Q,t("button",{class:"btn",onClick:S},X)])]),t("div",null,[t("div",Y,[t("table",Z,[t("thead",null,[t("tr",null,[$,tt,(c(!0),u(x,null,v(l.value.filter(e=>e.select),e=>(c(),u("th",et,_(e.title),1))),256)),st])]),t("tbody",null,[(c(!0),u(x,null,v(o.value,(e,a)=>(c(),u("tr",{key:a},[t("td",lt,_(e.ttrx),1),t("td",at,_(e.name),1),(c(!0),u(x,null,v(e.exams,i=>(c(),u("td",{class:"text-center",key:i.eid},_(i.score),1))),128)),t("td",ot,_(e.score),1)]))),128))])])])])]))}};export{it as default};
